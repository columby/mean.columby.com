<div class="dataset view" ng-controller="DatasetViewCtrl">

  <!-- Editor Sidebar -->
  <div class="editorSidebar" ng-show="editMode">
    <div class="editorSidebarContent">
      <a href="" ng-click="exitEditmode()">Exit edit mode</a>
      <button class="btn dbt-default" ng-show="contentEdited && dataset.publishStatus!=='unpublished'" ng-click="update()">Update</button>
      <button class="btn dbt-default" ng-show="dataset.publishStatus==='unpublished'" ng-click="create()">Create</button>


      <!--
      <h3>Publication settings</h3>

      <div class="autosave-status">
        <span ng-show="!dataset.draft[0]">No changes. </span>
        <span ng-show="dataset.draft[0]">Your dataset has unpublished changes. </span>
        <span ng-show="autosaveInProgress">Saving...</span>
      </div>
      -->

      <h3>Publication status</h3>
      <strong>{{dataset.publishStatus}}</strong>

      <h3>Publication account</h3>
      <img src="$root.selectedAccount.avatar.url"/>
      <a ui-sref="account.view({slug:dataset.account.slug})">{{$root.selectedAccount.name}}</a>

    </div>
  </div>

  <div class="content" ng-class="{show:!contentLoading}">

    <div class="header wrapper">
      <div class="container">

        <!-- Editable title -->
        <div class="title" ng-switch="editMode">
          <h1 ng-switch-default ng-bind-html="dataset.title || 'no title yet'"></h1>
          <h1 ng-switch-when="true"
            contenteditable
            name="title"
            ng-model="dataset.title"
            htmlFormat="plain">
          </h1>
        </div>

        <!-- Meta -->
        <div class="meta">
          <p>A dataset by <a ui-sref="account.view({slug:dataset.account.slug})">{{dataset.account.name}}</a>, published on <time class="post-date">{{dataset.created | date:'d MMMM yyyy'}}</time> <span class="edit" ng-show="dataset.canEdit && !editMode"><a href="" ng-click="enterEditmode()">edit</a></span></p>
        </div>

        <!-- Editable avatar -->
        <div class="avatar">
          <img src="{{dataset.account.avatar.url}}"/>
        </div>
      </div>
    </div>

    <!-- Dataset Description -->
    <div class="description wrapper">
      <!-- Editable description -->
      <div class="container">
        <div class="col-md-12" ng-switch="editMode">
          <div ng-switch-default ng-bind-html="dataset.description || '<p>The publisher of this dataset has not yet provided a description yet.</p>'"></div>
          <div
            ng-switch-when = "true">
            <div
              ng-model = "dataset.description"
              ng-blur = "updateDatasetDescription()"
              text-angular
              ta-toolbar = "[['quote','bold','italics','underline'],['ul','ol','indent','outdent'],['insertLink','insertVideo']]"
          ></div>
          </div>
        </div>
      </div>
    </div>

    <!-- Dataset Info -->
    <div class="info wrapper" ng-hide="editMode">
      <div class="container">
        <div class="content" ng-bind-html="summary"></div>
      </div>
    </div>

    <!-- Dataset Sources -->
    <div class="distributions wrapper" ng-hide="dataset.publishStatus==='unpublished'">
      <div class="container">
        <h3>Sources</h3>
        <ul ng-hide="!dataset.distributions || dataset.distributions.length===0">
          <li ng-repeat="distribution in dataset.distributions">
						<h4><a href="{{distribution.accessUrl}}" target="_blank">{{distribution.accessUrl}}</a></h4>
						<div class="date-size">{{distribution.distributionType}} - {{distribution.createdAt}} - {{distribution.size}}</div>
            <div class="actions" ng-show="editMode">
              <a href="" ng-click="editDistribution($index)"><i class="fa fa-edit"></i></a>
              <a href="" ng-click="deleteDistribution($index)"><i class="fa fa-trash"></i></a>
            </div>
					</li>
        </ul>
        <p ng-show="!dataset.distributions || dataset.distributions.length===0">No sources added yet</p>
        <h4 ng-show="editMode"><a href="" ng-click="openDistributionPopup()" class="new">+ Add a new datasource</a></h4>

        <!-- Datasource Modal -->
        <div class="addDistributionModal fullscreenPopup" ng-show="addDistribution">
          <button class="modal-close" ng-click="closeDistributionModal()">×</button>
          <div class="container add-distribution-content">
            <h2>Add a datasource (distribution)</h2>
            <div ng-bind-html="addDistribution.statusText"></div>
            <!-- File Upload -->
            <fileUpload />

            <!-- URL reference -->
            <form class="form-horizontal novalidate" role="form" name="linkUploadForm">
              <h3>Enter your url</h3>
              <div class="form-group">
                <div class="col-sm-10">
                  <input type="url" placeholder="http://yourlink.url" class="form-control" ng-model="newDistribution.link" name="link" required />
                </div>
                <div class="col-sm-2">
                  <button class="btn btn-default" ng-click="checkDistributionLink()" ng-disabled="!newDistribution.link">Check</button>
                </div>
                <div class="warning col-md-12">
                  {{newDistribution.validationMessage}}
                  {{errorMessage}}
                </div>
                <div class="col-sm-12">
                  <div ng-show="linkUploadForm.$invalid && !loginForm.$pristine" class="alert alert-warning" role="alert">
                    <span ng-show="linkUploadForm.link.$invalid && !loginForm.link.$pristine">Enter a valid url (don't forget http://).</span>
                  </div>
                </div>
              </div>

              <button class="btn btn-default" ng-click="createDistribution()" ng-disabled="!newDistribution.valid">Attach distribution</button>
            </form>
          </div>
        </div>
      </div>
    </div>

    <!-- Dataset Preview -->
    <div class="preview wrapper" ng-hide="editMode || !dataset.preview">
      <div class="content">
        <table class="table">
          <thead>
            <tr><td>1</td><td>1</td><td>1</td><td>1</td><td>1</td><td>1</td><td>1</td></tr>
          </thead>
          <tr><td>1</td><td>1</td><td>1</td><td>1</td><td>1</td><td>1</td><td>1</td></tr>
          <tr><td>1</td><td>1</td><td>1</td><td>1</td><td>1</td><td>1</td><td>1</td></tr>
          <tr><td>1</td><td>1</td><td>1</td><td>1</td><td>1</td><td>1</td><td>1</td></tr>
          <tr><td>1</td><td>1</td><td>1</td><td>1</td><td>1</td><td>1</td><td>1</td></tr>
          <tr><td>1</td><td>1</td><td>1</td><td>1</td><td>1</td><td>1</td><td>1</td></tr>
        </table>
      </div>
    </div>

    <!-- Dataset Use -->
    <div class="use wrapper" ng-hide="editMode">
      <div class="container">
        <div class="content">
          <h3>Use this dataset</h3>
          <p>Some text about how to use this data.</p>
        </div>
      </div>
    </div>

    <!-- Dataset UUID -->
    <div class="uuid wrapper" ng-show="dataset._id && !editMode">
      <div class="container">
        <div class="content">
          <h4>UUID: {{dataset._id}}</h4>
        </div>
      </div>
    </div>

    <!-- Dataset references -->
    <div class="references wrapper">
      <div class="container">
        <div class="content">
          <h3>References</h3>
          <ul>
            <li ng-repeat="reference in dataset.references">
							<div class="col-sm-2"><img src="{{reference.image}}" class="img-responsive"/></div>
              <div class="col-sm-10">
                <h4><a href="{{reference.url}}">{{reference.title}}</a></h4>
                <p>{{reference.description}}</p>
							  <p class="meta"><a href="{{reference.url}}">{{reference.provider_display}}</a></p>
              </div>
              <div class="actions" ng-show="editMode">
                <a href="" ng-click="deleteReference($index)"><i class="fa fa-trash"></i></a>
              </div>
						</li>
          </ul>
          <p ng-show="!dataset.references || dataset.references.length===0">No references added yet</p>
        </div>

        <h4 ng-show="editMode"><a href="" ng-click="openReferenceModal()" class="new">+ Add a new Reference</a></h4>

        <div class="addReferenceModal fullscreenPopup" ng-show="addReference">
          <button class="modal-close" ng-click="closeReferenceModal()">×</button>
          <div class="container add-refrence-content" ng-controller="EmbedlyCtrl">
            <h2>Add a reference</h2>
            <input type="text" ng-model="embedlyUrl">
            <button class="btn btn-default" ng-click="checkUrl()">Check</button>
            <div class="warning">{{errorMessage}}</div>
            <div class="preview" ng-show="embedlyResult">
              <a href="{{embedlyResult.original_url}}">
                <img src="{{embedlyResult.images[0].url}}" width="50px"/>
                <p><strong>{{embedlyResult.title}}</strong> -- {{embedlyResult.description}}</p>
                <p class="small">on {{embedlyResult.provider_name}}</p>
              </a>
            </div>
            <button type="submit" class="btn btn-default" ng-click="addReference()" ng-disabled="!embedlyResult">Add Reference</button>
          </div>
        </div>

      </div>
    </div>

    <!-- Dataset Account -->
    <div class="account wrapper" ng-hide="editMode">
      <div class="container">
        <div class="content">
            <h3>About {{dataset.account.name}}</h3>
            <div ng-bind-html="dataset.account.description"></div>
						<p class="more-about"><a ui-sref="account.view({slug: dataset.account.slug})">more about {{dataset.account.name}}</a></p>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
